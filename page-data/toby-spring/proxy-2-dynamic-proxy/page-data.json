{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/toby-spring/proxy-2-dynamic-proxy/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Dev Logs","author":"tykim","siteUrl":"https://disj11.github.io","comment":{"disqusShortName":"","utterances":""},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"8166d09c-9465-5125-925a-a27587f362f9","excerpt":"…","html":"<h2 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h2>\n<p>이번 포스트에서는 <a href=\"/toby-spring/proxy-1-proxy-and-pattern\">이전 포스트</a>에서 다뤘던 프록시의 문제를 해결하기 위한 다이내믹 프록시에 대해서 알아보고, 다이내믹 프록시를 적용하여 기존 코드의 문제를 해결해보자.</p>\n<h2 id=\"리플렉션\" style=\"position:relative;\"><a href=\"#%EB%A6%AC%ED%94%8C%EB%A0%89%EC%85%98\" aria-label=\"리플렉션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>리플렉션</h2>\n<p>다이내믹 프록시를 이해하려면 우선 리플렉션에 대해 알아야한다. 리플렉션은 자바의 코드 자체를 추상화해서 접근할 수 있도록 만든 것이며, 이를 쉽게 사용하도록 <code class=\"language-text\">java.lang.reflect</code> 패키지를 제공한다. 이 패키지의 클래스들을 이용하면, 인터페이스를 구현해서 클래스를 새로 정의하지 않고도 프록시를 손쉽게 만들 수 있다. 다이내믹 프록시도 리플렉션 기능을 이용하여 프록시를 만들어준다.</p>\n<p>이해를 돕기 위해 리플렉션 API 중 <code class=\"language-text\">Method</code> 라는 인터페이스를 이용해 메서드를 호출하는 방법을 알아보자. 자바에는 <code class=\"language-text\">클래스이름.class</code> 또는 오브젝트의 <code class=\"language-text\">getClass()</code> 메서드를 이용하여 <code class=\"language-text\">Class</code> 타입 오브젝트를 가져올 수 있다. 이 클래스 오브젝트를 이용하면 클래스 코드에 대한 메타정보를 가져오거나 오브젝트를 조작할 수 있다. 예를들어 다음과 같은 기능을 행할 수 있다.</p>\n<ol>\n<li>클래스의 이름</li>\n<li>어떤 클래스를 상속하는지</li>\n<li>어떤 인터페이스를 구현했는지</li>\n<li>어떤 필드를 갖고 있는지, 그 필드의 타입은 무엇인지</li>\n<li>메서드는 어떤 것을 정의했고, 파라미터와 리턴 타입은 무엇인지</li>\n<li>오브젝트의 필드 값 수정</li>\n<li>원하는 파라미터 값을 이용해 메서드 호출</li>\n</ol>\n<p><code class=\"language-text\">Method</code> 도 <code class=\"language-text\">Class</code> 에서 가져올 수 있다. 다음 코드는 <code class=\"language-text\">String</code> 의 <code class=\"language-text\">length</code> 메서드 정보를 가져온다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Method</span> lengthMethod <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMethod</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"length\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>가져온 메서드를 실행하고 싶다면 <code class=\"language-text\">invoke</code> 메서드를 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"Spring\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Method</span> lengthMethod <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMethod</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"length\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> length <span class=\"token operator\">=</span> lengthodMethod<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"다이내믹-프록시\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%9D%B4%EB%82%B4%EB%AF%B9-%ED%94%84%EB%A1%9D%EC%8B%9C\" aria-label=\"다이내믹 프록시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다이내믹 프록시</h2>\n<p>다이내믹 프록시는 프록시 팩토리에 의해 런타임 시 다이내믹하게 만들어지는 오브젝트이며, 타깃의 인터페이스와 같은 타입으로 만들어진다. 다음 그림은 다이내믹 프록시가 동작하는 방식이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 626px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwklEQVQY032Q2QqEMAxF+//fWB98cqm71gWXO5yAwzCIgdI2y8lN3HVd+j/Yvu8ahkFVVakoCpVlqXEcNc+z6rq2d9d1WtfVcvDHGOX0YMAoCCEoyzK1bWs3UCDLslgcMG8aA8TnSMjz3Lr0fW8J+ACgLEkSi9838V87z/N7M50DgpKmaQyICg7dp2kyOH/GYbxt2wzwtCoDQkYuhUimEN9xHKYwTVN5760hDVjHK5AgxahDFWoBMx4+VnGrvnf1BvwAZOXPiqBB2PoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"다이내믹 프록시 동작 방식\"\n        title=\"다이내믹 프록시 동작 방식\"\n        src=\"/static/29a084442d41f0c473e969bc32bfd35b/af590/dynamic-proxy-mechanism.png\"\n        srcset=\"/static/29a084442d41f0c473e969bc32bfd35b/5a46d/dynamic-proxy-mechanism.png 300w,\n/static/29a084442d41f0c473e969bc32bfd35b/0a47e/dynamic-proxy-mechanism.png 600w,\n/static/29a084442d41f0c473e969bc32bfd35b/af590/dynamic-proxy-mechanism.png 626w\"\n        sizes=\"(max-width: 626px) 100vw, 626px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>다이내믹 프록시를 사용하려면, 그림에서 보는 것과 같이 다이내믹 프록시로부터 메소드 호출 정보를 받아서 처리하는 <code class=\"language-text\">InvocationHandler</code> 의 구현체를 만들어야 한다. 다이내믹 프록시는 모든 요청을 <code class=\"language-text\">InvocationHandler</code> 의 <code class=\"language-text\">incoke()</code> 메소드로 보내주기 때문에 아무리 메서드가 많더라도 <code class=\"language-text\">invoke()</code> 메서드 하나로 처리할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1UlEQVQY0zWQiQ6AIAxD+f8/VPGKKN54x7umSyQZELa9dqi2bRGGIZIkge/7KMsS7/vieR4cx4E4jqEDjSAI4Hkeuq6TPGMcR1hrpS+KItR1DVVVlQCzLAPvDMK4zvNE0zQYhgHOOVC873vJUcwYI31aa8kxFDeSqcYmOqVqnudyd67Htm2Ypgn3fQuEBtI0FfesnedZRNZ1haIDPi7Lgn3fBU4XHO13TFGeBP9v7CO4KAoBXtcleUUYlf4ki+nkH5muWUh1uuQkXARYW8jf8X+NyWTkD9fJeDXDj24KAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"InvocationHandler를 통한 요청 처리 구조\"\n        title=\"InvocationHandler를 통한 요청 처리 구조\"\n        src=\"/static/9cd1d91c41d4ab31a2c44fc7e6a227eb/c1b63/invocation-handler-process.png\"\n        srcset=\"/static/9cd1d91c41d4ab31a2c44fc7e6a227eb/5a46d/invocation-handler-process.png 300w,\n/static/9cd1d91c41d4ab31a2c44fc7e6a227eb/0a47e/invocation-handler-process.png 600w,\n/static/9cd1d91c41d4ab31a2c44fc7e6a227eb/c1b63/invocation-handler-process.png 1200w,\n/static/9cd1d91c41d4ab31a2c44fc7e6a227eb/d61c2/invocation-handler-process.png 1800w,\n/static/9cd1d91c41d4ab31a2c44fc7e6a227eb/97a96/invocation-handler-process.png 2400w,\n/static/9cd1d91c41d4ab31a2c44fc7e6a227eb/21de8/invocation-handler-process.png 2436w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이제 다이내믹 프록시를 적용해보자.</p>\n<h3 id=\"기존-코드\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EC%A1%B4-%EC%BD%94%EB%93%9C\" aria-label=\"기존 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기존 코드</h3>\n<p>기존 코드는 다음과 같으며, 이 코드의 문제점은 <a href=\"/spring/proxy-and-pattern/#%ED%94%84%EB%A1%9D%EC%8B%9C%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90\">이전 포스트</a>에서 설명하였다. 이 코드에 다이내믹 프록시를 적용해 볼 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">TransactionStatus</span> status <span class=\"token operator\">=</span> transactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">getTransaction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultTransactionDefinition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 트랜잭션 시작</span>\n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> users <span class=\"token operator\">=</span> userDao<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user <span class=\"token operator\">:</span> users<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\tuser<span class=\"token punctuation\">.</span><span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tuserDao<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserServiceTx</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">UserService</span> userService<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">PlatformTransactionManager</span> transactionManager <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataSourceTransactionManager</span><span class=\"token punctuation\">(</span>dataSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setTransactionManager</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PlanformTransactionManager</span> transactionManager<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>trasactionManager <span class=\"token operator\">=</span> transactionManager<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setUserService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserService</span> userService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>userService <span class=\"token operator\">=</span> userService<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">TransactionStatus</span> status <span class=\"token operator\">=</span> transactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">getTransaction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultTransactionDefinition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 트랜잭션 시작</span>\n\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\t\t\tuserService<span class=\"token punctuation\">.</span><span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\ttransactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">RunctimeException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\ttransactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"다이내믹-프록시-적용\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%9D%B4%EB%82%B4%EB%AF%B9-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%A0%81%EC%9A%A9\" aria-label=\"다이내믹 프록시 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다이내믹 프록시 적용</h3>\n<p><code class=\"language-text\">InvocationHandler</code> 인터페이스를 구현하여 트랜잭션 부가기능을 가진 핸들러를 만들어보자.</p>\n<div id=\"transaction-handler\">\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TransactionHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">InvocationHandler</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">PlatformTransactionManager</span> transactionManager<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Object</span> target<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 부가기능을 제공할 타깃</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> pattern<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 트랜잭션을 적용할 메소드 이름 패턴</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setTarget</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> target<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>target <span class=\"token operator\">=</span> target<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setTransactionManager</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PlatformTransactionManager</span> transactionManager<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>transactionManager <span class=\"token operator\">=</span> transactionManager<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> proxy<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Method</span> method<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Throwable</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>method<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span>pattern<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">invokeInTransaction</span><span class=\"token punctuation\">(</span>method<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> method<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">invokeInTransaction</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Method</span> method<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Throwable</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">TransactionStatus</span> status <span class=\"token operator\">=</span> transactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">getTransaction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultTransactionDefinition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token class-name\">Object</span> ret <span class=\"token operator\">=</span> method<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>transactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">return</span> ret<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InvocationTargetException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\ttransactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getTargetException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</div>\n<p>요청을 위임할 <code class=\"language-text\">target</code> 과 어떤 메서드에 부가 기능을 적용할 지 설정할 수 있는 <code class=\"language-text\">pattern</code> 을 제공받도록 하였다. <code class=\"language-text\">Method.invoke()</code> 를 이용해 타깃 오브젝트의 메서드를 호출할 때는 타깃 오브젝트에서 발생하는 예외가 <code class=\"language-text\">InvocationTargetException</code> 으로 포장되어 전달되기때문에 <code class=\"language-text\">getTargetException()</code> 메서드로 중첩되어있는 예외를 가져오도록 하였다.</p>\n<p>만들어본 코드는 이전 포스트에서 만들었던 <a href=\"/toby-spring/proxy-2-dynamic-proxy#user-service-tx\">UserServiceTx</a>와 같은 기능을 하지만, <code class=\"language-text\">UserService</code> 뿐만 아니라 트랜잭션이 필요한 모든 오브젝트에 적용할 수 있다. 만들어진 <code class=\"language-text\">TransactionHandler</code> 를 사용하는 방법은 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">TransactionHandler</span> txHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TransactionHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ntxHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setTarget</span><span class=\"token punctuation\">(</span>userService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ntxHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setTransactionManager</span><span class=\"token punctuation\">(</span>transactionManager<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ntxHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setPattern</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"upgradeLevels\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">UserService</span> txUserService <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UserService</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Proxy</span><span class=\"token punctuation\">.</span><span class=\"token function\">newProxyInstance</span><span class=\"token punctuation\">(</span>\n\t<span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token keyword\">new</span> <span class=\"token class-name\">Class</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">{</span><span class=\"token class-name\">UserService</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\ttxHandler\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ntxUserService<span class=\"token punctuation\">.</span><span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"다이내믹-프록시의-문제점\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%9D%B4%EB%82%B4%EB%AF%B9-%ED%94%84%EB%A1%9D%EC%8B%9C%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"다이내믹 프록시의 문제점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다이내믹 프록시의 문제점</h3>\n<p>다이내믹 프록시를 적용하여 기존 코드의 문제점을 해결했지만, 다른 문제가 발생하였다. 다이내믹 프록시 오브젝트를 일반적인 스프링의 빈으로 등록할 수 없다는 것이다. 스프링은 빈 정의에 나오는 클래스의 이름을 가지고 다음과 같은 리플렉션 API를 통해 빈 오브젝트를 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Date</span> now <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Date</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"java.util.Date\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">newInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </code></pre></div>\n<p>하지만 다이내믹 프록시 오브젝트의 클래스는 어떤 것인지 알 수가 없다. 따라서 프록시 오브젝트의 클래스 정보를 미리 알아내서 스프링 빈에 정의할 방법이 없으며, 오직 <code class=\"language-text\">Proxy</code> 클래스의 <code class=\"language-text\">newInstance()</code> 메서드를 통해서만 만들 수 있다. 그렇다면 다이내믹 프록시 오브젝트를 빈으로 등록할 수 있는 방법은 정말 없는 걸까?</p>\n<h3 id=\"팩토리-빈\" style=\"position:relative;\"><a href=\"#%ED%8C%A9%ED%86%A0%EB%A6%AC-%EB%B9%88\" aria-label=\"팩토리 빈 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>팩토리 빈</h3>\n<p>이 문제는 팩토리 빈을 통하여 해결할 수 있다. 팩토리 빈은 오브젝트의 생성 로직을 담당하는 역할을 한다. 팩토리 빈을 만드는 가장 간단한 방법은 <code class=\"language-text\">FactoryBean</code> 인터페이스를 구현하는 것이며, 이렇게 구현한 클래스를 빈으로 등록하면 <strong>팩토리 빈 내부에서 생성하는 오브젝트가 빈 오브젝트로 사용</strong>된다. 팩토리 빈은 다음과 같은 세 가지 메서드로 구성되어있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">FactoryBean</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">T</span> <span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Spring 컨테이너에서 사용할 객체</span>\n\t<span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getObjectType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// FactoryBean이 생성하는 객체의 타입 유형</span>\n\t<span class=\"token keyword\">boolean</span> <span class=\"token function\">isSingleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// getObject()로 생성된객체가 싱글톤인지 여부</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음은 팩토리 빈을 구현한 클래스이다.</p>\n<div id=\"tx-proxy-factory-bean\">\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TxProxyFactoryBean</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FactoryBean</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">Object</span> target<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">PlatformTransactionManager</span> transactionManager<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">String</span> pattern<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> serviceInterface<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// setter 생략</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">TransactionHandler</span> txHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TransactionHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttxHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setTarget</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttxHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setTransactionManager</span><span class=\"token punctuation\">(</span>transactionManager<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttxHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setPattern</span><span class=\"token punctuation\">(</span>pattern<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">Proxy</span><span class=\"token punctuation\">.</span><span class=\"token function\">newProxyInstance</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token keyword\">new</span> <span class=\"token class-name\">Class</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">{</span>serviceInterface<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t\ttxHandler\n\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getObjectType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> serviceInterface<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isSingleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 싱글톤 빈이 아니라는 뜻이 아니라 getObject()가 매번 같은 오브젝트를 리턴해주지 않는다는 의미</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</div>\n<p>빈으로 등록시 사용할 설정 값은 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bean</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>userService<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>springbook.user.service.TxProxyFactoryBean<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>target<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>userServiceImpl<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transactionManager<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transactionManager<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>upgradeLevels<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>serviceInterface<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>springbook.user.service.UserService<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bean</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><code class=\"language-text\">target</code> 과 <code class=\"language-text\">transactionManager</code> 프로퍼티는 다른 빈을 가리키는 것이므로 ref 애트리뷰트로 설정하였고, <code class=\"language-text\">pattern</code> 은 단순 문자열이니 value 값으로 설정하였다. <code class=\"language-text\">serviceInterface</code> 는 Class 타입이지만 스프링에서 setter를 확인하여 자동 변환시켜주므로 value 값으로 설정한다.</p>\n<p>만약 자바 기반으로 설정을 구성하고 싶다면 XML 기반의 구성과는 약간 다르게 <code class=\"language-text\">getObject()</code> 메서드를 명시적으로 호출해야한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FacotryBeanAppConfig</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"userServiceFactory\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">TxProxyFactoryBean</span> <span class=\"token function\">txProxyFactoryBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">TxProxyFactoryBean</span> factory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TxProxyFactoryBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tfactory<span class=\"token punctuation\">.</span><span class=\"token function\">setTarget</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tfactory<span class=\"token punctuation\">.</span><span class=\"token function\">setTransactionManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tfactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPattern</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tfactory<span class=\"token punctuation\">.</span><span class=\"token function\">setServiceInterface</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> factory<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token annotation punctuation\">@Bean</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UserService</span> <span class=\"token function\">userService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> txProxyFactoryBean<span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>빈으로 등록을 완료했다면 다음과 같이 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FactoryBeanTest</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token annotation punctuation\">@Autowired</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">UserService</span> userService<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@Resource</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"&amp;userService\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token class-name\">TxProxyFactoryBean</span> txProxyFactoryBean<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>앞서 설명한대로 팩토리 빈 자체가 아닌 FactoryBean에 의해 생성된 오브젝트가 빈 오브젝트로 사용되므로 <code class=\"language-text\">@Autowired</code> 를 통해 <code class=\"language-text\">UserService</code> 를 DI 받을 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4UlEQVQY0z2QCQqFMAxEe/8LKoj7vi8oIqLzeQF/YWiaZCaTunme1TSNuq6zmzfYtk3rumqaJo3jaHfbthqG4d8DB1BblsU4DtJHQPATiKJIWZaZAHn64jhW3/c6jkN1XStLU3mepzAMlSSJibr3fcV5nseEcAEJAkCwKArL42DfdwPOqDOEwRgBDjJCNF/XZdNZBxHf902QGnlyQRAYcE0NEeoYuu9bjqY0TW0iLnjneW5iEHl/buhjNb6DuKoqlWWp8zxtS7Z1uMMRYsRMRpA1IBGT539wxF8Sw/nc4+7DD4pbwmtnm74VAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"factory bean\"\n        title=\"factory bean\"\n        src=\"/static/af0df91c66fe97c4e0313e513351cc96/c1b63/factory-bean.png\"\n        srcset=\"/static/af0df91c66fe97c4e0313e513351cc96/5a46d/factory-bean.png 300w,\n/static/af0df91c66fe97c4e0313e513351cc96/0a47e/factory-bean.png 600w,\n/static/af0df91c66fe97c4e0313e513351cc96/c1b63/factory-bean.png 1200w,\n/static/af0df91c66fe97c4e0313e513351cc96/913a1/factory-bean.png 1476w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>만약 팩토리 빈 자체를 사용하고 싶다면 빈 이름 앞에 <code class=\"language-text\">&amp;</code> 를 붙이기만 하면 된다.</p>\n<p>이제 다른 서비스에서도 트랜잭션 기능을 사용하고 싶다면 타깃 오브젝트에 맞는 프로퍼티 정보를 설정하여 빈으로 등록해주기만 하면 된다.</p>\n<h2 id=\"프록시-팩토리-빈-방식의-장점\" style=\"position:relative;\"><a href=\"#%ED%94%84%EB%A1%9D%EC%8B%9C-%ED%8C%A9%ED%86%A0%EB%A6%AC-%EB%B9%88-%EB%B0%A9%EC%8B%9D%EC%9D%98-%EC%9E%A5%EC%A0%90\" aria-label=\"프록시 팩토리 빈 방식의 장점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>프록시 팩토리 빈 방식의 장점</h2>\n<p>프록시 팩토리 빈 방식의 장점은 이전 포스트에서 알아봤던 문제점을 해결할 수 있다는 것이다. 문제점으로는 다음과 같은 것들이 있었다.</p>\n<ol>\n<li>프록시를 적용할 대상이 구현하고 있는 인터페이스를 구현하는 프록시 클래스를 일일이 만들어야 한다.</li>\n<li>부가적인 기능이 여러 메소드에 반복적으로 나타나게되어 중복 코드가 발생한다.</li>\n</ol>\n<p>다이내믹 프록시를 이용하여 이 두가지 문제점을 해결할 수 있음을 살펴보았다. 여기에 팩토리 빈까지 사용하여 번거로운 다이내믹 프록시 생성 코드도 제거할 수 있었으며, DI 설정만으로 다양한 타깃 오브젝트에 적용이 가능하게 만들었다.</p>\n<p>하지만 프록시 팩토리 빈 방식의 한계점도 존재한다.</p>\n<h2 id=\"프록시-팩토리-빈-방식의-한계\" style=\"position:relative;\"><a href=\"#%ED%94%84%EB%A1%9D%EC%8B%9C-%ED%8C%A9%ED%86%A0%EB%A6%AC-%EB%B9%88-%EB%B0%A9%EC%8B%9D%EC%9D%98-%ED%95%9C%EA%B3%84\" aria-label=\"프록시 팩토리 빈 방식의 한계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>프록시 팩토리 빈 방식의 한계</h2>\n<p>지금 만들어본 프록시 팩토리는 타깃 정보를 갖고 있다. 이러한 구조상의 문제로 여러 개의 클래스의 메서드에 부가기능을 적용하고 싶다면, 거의 비슷한 프록시 팩토리 빈의 설정이 중복되는 것을 막을 수 없다. 만약 타깃이 같다고 하더라도 여러 개의 부가기능을 적용하고 싶다고 하면 비슷한 문제가 발생한다. 또 다른 문제로 <code class=\"language-text\">TransactionHandler</code> 의 오브젝트가 프록시 팩토리 빈의 개수만큼 만들어진다는 것이다. <code class=\"language-text\">TransactionHandler</code> 가 타깃의 정보를 갖고 있기 때문에 발생하는 문제이다.</p>\n<p><a href=\"/toby-spring/proxy-3-proxy-factory-bean\">다음 포스트</a>에서는 이런 한계를 해결하기 위한 방법을 알아보자.</p>","frontmatter":{"title":"프록시 2 - 다이내믹 프록시와 팩토리 빈","date":"September 27, 2021"}}},"pageContext":{"slug":"/toby-spring/proxy-2-dynamic-proxy/","previous":{"fields":{"slug":"/toby-spring/proxy-1-proxy-and-pattern/"},"frontmatter":{"title":"프록시 1 - 프록시와 프록시를 사용한 패턴"}},"next":{"fields":{"slug":"/toby-spring/proxy-3-proxy-factory-bean/"},"frontmatter":{"title":"프록시 3 - 프록시 팩토리 빈과 빈 후처리기"}}}},
    "staticQueryHashes": ["3078735561","3128451518"]}