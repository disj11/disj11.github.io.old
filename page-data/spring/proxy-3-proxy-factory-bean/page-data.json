{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/spring/proxy-3-proxy-factory-bean/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Dev Logs","author":"tykim","siteUrl":"https://disj11.github.io","comment":{"disqusShortName":"","utterances":""},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"94b12cbb-dab8-5b50-8cec-0dbfe8522bdb","excerpt":"개요 이전 포스트에서 프록시 팩토리와 한계점에 관하여 알아보았다. 이번 포스트에서는 이러한 한계점을 스프링은 어떤 방식으로 해결책을 제시하였는지 알아보자. ProxyFactoryBean 스프링은 프록시 오브젝트를 생성해주는 기술을 추상화한 팩토리 빈을 제공해준다.  이 스프링에서 제공해주는 팩토리 빈이다.  을 상속받아서 구현했던 TxProxyFactoryBean…","html":"<h2 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h2>\n<p><a href=\"/spring/proxy-2-dynamic-proxy\">이전 포스트</a>에서 프록시 팩토리와 한계점에 관하여 알아보았다. 이번 포스트에서는 이러한 한계점을 스프링은 어떤 방식으로 해결책을 제시하였는지 알아보자.</p>\n<h2 id=\"proxyfactorybean\" style=\"position:relative;\"><a href=\"#proxyfactorybean\" aria-label=\"proxyfactorybean permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ProxyFactoryBean</h2>\n<p>스프링은 프록시 오브젝트를 생성해주는 기술을 추상화한 팩토리 빈을 제공해준다. <code class=\"language-text\">ProxyFactoryBean</code> 이 스프링에서 제공해주는 팩토리 빈이다. <code class=\"language-text\">FactoryBean&lt;T></code> 을 상속받아서 구현했던 <a href=\"https://www.notion.so/2-439670511c854cd4860a7c9226041826\">TxProxyFactoryBean</a>과 달리 <code class=\"language-text\">ProxyFactoryBean</code> 는 순수하게 프록시를 생성하는 작업만을 담당하고, 프록시를 통해 제공해줄 부가기능은 별도의 빈에 둘 수 있다.</p>\n<h2 id=\"methodinterceptor\" style=\"position:relative;\"><a href=\"#methodinterceptor\" aria-label=\"methodinterceptor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MethodInterceptor</h2>\n<p><code class=\"language-text\">ProxyFacctoryBean</code> 이 생성하는 프록시에서 사용할 부가기능은 <code class=\"language-text\">MethodInterceptor</code> 인터페이스를 구현하여 만든다. <code class=\"language-text\">MethodInterceptor</code> 는 <code class=\"language-text\">InvocationHandler</code> 와 비슷하지만 한 가지 차이가 있다. <code class=\"language-text\">InvocationHandler</code> 의 <code class=\"language-text\">invoke()</code> 메서드는 타깃 오브젝트에 대한 정보를 제공하지 않는다. 따라서 <code class=\"language-text\">InvocationHandler</code> 를 구현한 클래스에서 타깃에 대한 정보를 직접 알고있어야 한다. 하지만 <code class=\"language-text\">MethodInterceptor</code> 의 <code class=\"language-text\">invoke()</code> 메서드는 <code class=\"language-text\">ProxyFactoryBean</code> 으로부터 타깃 오브젝트에 대한 정보를 함께 제공받는다. 이 차이로 <code class=\"language-text\">MethodInterceptor</code> 는 타깃 오브젝트에 상관 없이 독립적으로 만들어 질 수 있다. 따라서 타깃이 다른 여러 프록시에서 함께 사용할 수 있으며, 싱글톤 빈으로 등록 가능하다.</p>\n<h2 id=\"proxyfactorybean-적용\" style=\"position:relative;\"><a href=\"#proxyfactorybean-%EC%A0%81%EC%9A%A9\" aria-label=\"proxyfactorybean 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ProxyFactoryBean 적용</h2>\n<p>스프링이 제공하는 <code class=\"language-text\">ProxyFactoryBean</code> 을 이용하도록 수정해보자.</p>\n<h3 id=\"어드바이스\" style=\"position:relative;\"><a href=\"#%EC%96%B4%EB%93%9C%EB%B0%94%EC%9D%B4%EC%8A%A4\" aria-label=\"어드바이스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어드바이스</h3>\n<p>먼저 <a href=\"/proxy-2-dynamic-proxy#transaction-handler\">InvocationHandler</a>를 구현했던 코드를 <code class=\"language-text\">MethodInterceptor</code> 를 구현하도록 변경한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TransactionAdvice</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">MethodInterceptor</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">PlatformTransactionManager</span> transactionManager<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setTransactionManager</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PlatformTransactionManager</span> transactionManager<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>transactionManager<span class=\"token operator\">=</span> transactionManager<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MethodInvocation</span> invocation<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token class-name\">Throwable</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">TransactionStatus</span> status <span class=\"token operator\">=</span> transactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">getTransaction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultTransactionDefinition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token class-name\">Object</span> ret <span class=\"token operator\">=</span> invocation<span class=\"token punctuation\">.</span><span class=\"token function\">proceed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 콜백을 호출하여 타깃의 메서드를 실행</span>\n\t\t\ttransactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">return</span> ret<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">RuntimeException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\ttransactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>앞서 설명했듯이, <code class=\"language-text\">MethodInterceptor</code> 의 <code class=\"language-text\">invoke()</code> 메서드는 <code class=\"language-text\">ProxyFactoryBean</code> 으로부터 타깃에 대한 정보까지 함께 제공받는다. <code class=\"language-text\">MethodInvocation</code> 의 <code class=\"language-text\">proceed()</code> 메서드를 실행하면 타깃 오브젝트의 메서드를 내부적으로 실행해준다. 이렇게 매개변수로 <code class=\"language-text\">MethodInvocation</code> 이라는 타깃 정보를 전달받기 때문에, <code class=\"language-text\">InvocationHandler</code> 를 이용했을때보다 훨씬 간결해졌다. 타깃 메서드가 던지는 예외도 <code class=\"language-text\">InvocationTargetException</code> 으로 포장되는 것이 아니기 때문에 그대로 잡아서 처리하면 된다.</p>\n<p>부가기능을 만들었다면 다음과 같이 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">ProxyFactoryBean</span> pfBean <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ProxyFactoryBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npfBean<span class=\"token punctuation\">.</span><span class=\"token function\">setTarget</span><span class=\"token punctuation\">(</span>userService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npfBean<span class=\"token punctuation\">.</span><span class=\"token function\">addAdvice</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">TransactionAdvice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">UserService</span> userService <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UserService</span><span class=\"token punctuation\">)</span> pfBean<span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nuserService<span class=\"token punctuation\">.</span><span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>코드에서 보는 것처럼 <code class=\"language-text\">ProxyFactoryBean</code> 은 <code class=\"language-text\">addAdvice()</code> 메서드를 통해 여러 개의 <code class=\"language-text\">MethodInterceptor</code> 를 추가할 수 있다. 이전 포스트에서 살펴봤던 프록시 팩토리 빈의 단점 중 하나였던, 새로운 부가기능을 추가할 때마다 프록시와 프록시 팩토리 빈을 추가해야 한다는 문제를 해결 할 수 있다.</p>\n<p>메서드 이름을 보면 addMethodInterceptor가 아니라 <code class=\"language-text\">addAdvice</code> 인데, 이는 <code class=\"language-text\">MethodInterceptor</code> 가 <code class=\"language-text\">Advice</code> 인터페이스를 상속하고 있는 서브 인터페이스이기 때문이다. 이름에서 알 수 있 듯이 스프링에서는 타깃 오브젝트에 적용하는 부가기능을 담은 오브젝트를 <strong>어드바이스</strong>라고 부른다.</p>\n<h3 id=\"포인트컷\" style=\"position:relative;\"><a href=\"#%ED%8F%AC%EC%9D%B8%ED%8A%B8%EC%BB%B7\" aria-label=\"포인트컷 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>포인트컷</h3>\n<p>기존에 <code class=\"language-text\">InvocationHandler</code> 를 직접 구현했을 때는 부가기능 적용 외에도 한 가지 기능이 더 있었다. 메서드의 이름을 가지고 부가기능 적용 대상 메서드를 선정하는 것이었다. 앞에서 만들어본 어드바이스에는 이 기능이 빠져있다. <code class=\"language-text\">MethodInterceptor</code> 은 타깃 정보가 없어 여러 프록시에서 공유할 수 있다고 하였는데, 특정 프록시에만 적용되는 메서드 선정 알고리즘을 넣으면 이런 장점이 사라지기 때문이다. 스프링은 이러한 문제를 해결하기 위해 부가기능 선정 기능인 어드바이스와, 메서드 선정 알고리즘을 정하는 기능을 아예 구분하였다. 메서드 선정 알고리즘을 담은 오브젝트는 <strong>포인트컷</strong>이라고 부른다. 앞서 만든 어드바이스에 포인트컷을 적용한 코드는 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">ProxyFactoryBean</span> pfBean <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ProxyFactoryBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npfBean<span class=\"token punctuation\">.</span><span class=\"token function\">setTarget</span><span class=\"token punctuation\">(</span>userService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">NameMatchMethodPointcut</span> pointcut <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NameMatchMethodPointcut</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npointcut<span class=\"token punctuation\">.</span><span class=\"token function\">setMappedName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"upgrade*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npfBean<span class=\"token punctuation\">.</span><span class=\"token function\">addAdvicor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultPointcutAdvisor</span><span class=\"token punctuation\">(</span>pointcut<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TransactionAdvice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">UserService</span> userService <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UserService</span><span class=\"token punctuation\">)</span> pfBean<span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nuserService<span class=\"token punctuation\">.</span><span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">ProxyFactoryBean</code> 을 이용한 방식의 작업 흐름은 다음 그림과 같다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVQY01XLzaqEIBgA0N7/4ZpNBEr1IaamVv6VmBpzwdWdsz+da5RSxpj7vp1zxphpmgghOWfG2OfzoZSmlI7jKKV8/+mstUKIYRiEECEE59x1XdbapUHNOI4AwBirtf7k0FwNYwwAtm1DCPV9DwAYY4QQAFBKOefv+/5k732ttZQSY5RSaq3neV7XlRCiteacL8vCG4yx1toYo5SSUnrvu6fJOYcQpJRCCM659z7nHGNMKT3Pk1KKMXrvtdb7vqvmPM8/JswVxhj3G6cAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"스프링의 ProxyFacotyrBean을 이용한 방식\"\n        title=\"스프링의 ProxyFacotyrBean을 이용한 방식\"\n        src=\"/static/2b1b00a66575ddcf161630087da21aee/c1b63/proxy-factory-bean.png\"\n        srcset=\"/static/2b1b00a66575ddcf161630087da21aee/5a46d/proxy-factory-bean.png 300w,\n/static/2b1b00a66575ddcf161630087da21aee/0a47e/proxy-factory-bean.png 600w,\n/static/2b1b00a66575ddcf161630087da21aee/c1b63/proxy-factory-bean.png 1200w,\n/static/2b1b00a66575ddcf161630087da21aee/21b4d/proxy-factory-bean.png 1280w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>포인트컷을 적용하기 전에는 <code class=\"language-text\">addAdvice()</code> 로 어드바이스만 등록하면 됐다. 하지만 포인트컷을 함께 등록할 때에는 <code class=\"language-text\">Advisor</code> 타입으로 묶어 <code class=\"language-text\">addAdvisor()</code> 메서드를 호출해야한다. 그 이유는 <code class=\"language-text\">ProxyFactoryBean</code> 에 여러 개의 어드바이스와 포인트컷이 추가될 수 있기 때문인데, 포인트컷과 어드바이스를 따로 등록하게되면 어떤 어드바이스에 어떤 포인트컷을 적용할지 애매해지기 때문이다. 메서드 이름에서도 알 수 있듯 포인트컷과 어드바이스를 묶은 오브젝트를 인터페이스 이름을 따서 <strong>어드바이저</strong>라고 부른다.</p>\n<h3 id=\"빈-설정\" style=\"position:relative;\"><a href=\"#%EB%B9%88-%EC%84%A4%EC%A0%95\" aria-label=\"빈 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>빈 설정</h3>\n<p><code class=\"language-text\">ProxyFactoryBean</code> 을 사용한 코드를 작성해보았으니, 이제 빈 설정을 해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bean</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transactionAdvice<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>springbook.user.service.TransactionAdvice<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transactionManager<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transactionManager<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bean</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bean</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transactionPointcut<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.springframework.aop.support.NameMatchMethodPointcut<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mappedName<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>upgrade*<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bean</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bean</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transactionAdvisor<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.springframework.aop.support.DefaultPointcutAdvisor<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>advice<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transactionAdvice<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pointcut<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transactionPointcut<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bean</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bean</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>userService<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.springframework.aop.framework.ProxyFactoryBean<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>target<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>userServiceImpl<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>interceptorNames<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>list</span><span class=\"token punctuation\">></span></span>\n\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>transactionAdvisor<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>list</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bean</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2 id=\"어드바이스와-포인트컷의-재사용\" style=\"position:relative;\"><a href=\"#%EC%96%B4%EB%93%9C%EB%B0%94%EC%9D%B4%EC%8A%A4%EC%99%80-%ED%8F%AC%EC%9D%B8%ED%8A%B8%EC%BB%B7%EC%9D%98-%EC%9E%AC%EC%82%AC%EC%9A%A9\" aria-label=\"어드바이스와 포인트컷의 재사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어드바이스와 포인트컷의 재사용</h2>\n<p><code class=\"language-text\">UserService</code> 외에 새로운 서비스 클래스가 만들어져도 이미 만들어둔 <code class=\"language-text\">TransactionAdvice</code> 를 그대로 사용할 수 있다. 메소드 선정을 위한 포인트컷이 필요하면 이름 패턴만 지정해서 <code class=\"language-text\">ProxyFactoryBean</code> 에 등록해주면 된다. 다음은 <code class=\"language-text\">ProxyFactoryBean</code> 을 이용하여 많은 수의 서비스 빈에게 트랜잭션 부가기능을 적용한 모습이다. <code class=\"language-text\">TransactionAdvice</code> 는 하나만 만들어서 싱글톤 빈으로 등록해주면, DI 설정을 통해 모든 서비스에 적용이 가능하다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMklEQVQoz12R646CUAyEef+n4y+gAip3Be+CXLr5ZvcYV5JJaTNnOm29ZVlsnmdzses6OxwOivf73Z7Pp/V9r0j+ie/a7XYzzz6+aZqsrmsLgsDSNFUDao/HQ02SJLHdbqeYZZlVVaX//X4v1E1tHsrX61Xql8tFyPPcVquVHpzPZzmBQ70sC8vyTI2Px6OVZSkeaNvWPJRdlzAMJUQTN7oTJN9ut+IREWqaxoqiEMjheIwF+IZhUBHCZrMx3/cVcU93hBiVCAeXuKaGoBxyDMD3er00GvuDPM+T8tPppMMQcexADlgTPPBPcBxH7SKO4z/BX+eI4fxTEBEXAVPoyt8O2R/CjM/uuDB1xomiSM3W6/V7j+RMBNjpW9CBx4gB3HIEHrIn/hGmIYDPpRFjpzj8Aa+nrC4Agq4wAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"어드바이스와 포인트컷의 재사용\"\n        title=\"어드바이스와 포인트컷의 재사용\"\n        src=\"/static/0881d332e1c71102637a700bdc620b03/c1b63/advice-pointcut.png\"\n        srcset=\"/static/0881d332e1c71102637a700bdc620b03/5a46d/advice-pointcut.png 300w,\n/static/0881d332e1c71102637a700bdc620b03/0a47e/advice-pointcut.png 600w,\n/static/0881d332e1c71102637a700bdc620b03/c1b63/advice-pointcut.png 1200w,\n/static/0881d332e1c71102637a700bdc620b03/21b4d/advice-pointcut.png 1280w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>여기서 한 가지 의문이 들 수 있다. 부가기능은 한 번만 만들어 모든 타깃과 메서드에 재사용 가능하고, 타깃의 적용 메서드를 선정하는 방식도 독립적으로 분리하였지만, 새로운 서비스가 생길때마다 ProxyFactoryBean 빈 설정 정보를 추가해줘야 한다는 것이다. 다이내믹 프록시가 인터페이스만 제공하면 모든 메서드에 대한 구현클래스를 자동으로 만들듯이, 일정한 타깃 빈의 목록을 제공하면 자동으로 각 타깃 빈에 대한 프록시를 만들 수는 없을까?</p>\n<h2 id=\"빈-후처리기\" style=\"position:relative;\"><a href=\"#%EB%B9%88-%ED%9B%84%EC%B2%98%EB%A6%AC%EA%B8%B0\" aria-label=\"빈 후처리기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>빈 후처리기</h2>\n<p>빈 후처리기는 <code class=\"language-text\">BeanPostProcessor</code> 인터페이스를 구현해서 만들며, 이름 그대로 스프링 빈 오브젝트가 만들어진 후에 빈 오브젝트를 다시 가공할 수 있게 해준다.</p>\n<h3 id=\"자동-프록시-생성기\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EB%8F%99-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%83%9D%EC%84%B1%EA%B8%B0\" aria-label=\"자동 프록시 생성기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자동 프록시 생성기</h3>\n<p>스프링이 제공하는 빈 후처리기 중 하나인 <code class=\"language-text\">DefaultAdvisorAutoProxyCreator</code> 를 잘 이용하면, 스프링이 생성하는 빈 오브젝트의 일부를 프록시로 보장하고, 프록시를 빈으로 대신 등록할 수 있다. 다음 그림은 빈 후처리기를 이용한 자동 프록시 생성 방법을 설명한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAu0lEQVQY0zVP2Q6EIBDz/z+PfcCVRdEY4wGeUaNRu5lulqQMc7RTohAC6rpG0zRIkgRpmsIYw1hVFcqyZG9ZFvR9j3EcmUtduF3Xked9YD+SS5p5nqMoCrRtywX/OAwDRYSklOISgQg556C1hlIvaB0zj0LwmOcZ0zQRWZbBWgubWr7XdSW89xQRd+I+jt8w5gPncroX7nVdiLZto7PfgKGr/1dk6DxPQobv+8ZxHBCOLBGhfd9Zl/M8D75FICqLZhOH1gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"자동 프록시 생성기\"\n        title=\"자동 프록시 생성기\"\n        src=\"/static/cee6338c4f13e38b41816cfffbfeba4c/c1b63/auto-proxy-creator.png\"\n        srcset=\"/static/cee6338c4f13e38b41816cfffbfeba4c/5a46d/auto-proxy-creator.png 300w,\n/static/cee6338c4f13e38b41816cfffbfeba4c/0a47e/auto-proxy-creator.png 600w,\n/static/cee6338c4f13e38b41816cfffbfeba4c/c1b63/auto-proxy-creator.png 1200w,\n/static/cee6338c4f13e38b41816cfffbfeba4c/21b4d/auto-proxy-creator.png 1280w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그림과 같이 <code class=\"language-text\">DefaultAdvisorAutoProxyCreator</code> 는 빈으로 등록된 모든 어드바이저 내의 포인트컷을 이용하여 전달받은 빈이 프록시 적용 대상인지 확인한다. 프록시 적용 대상이라면 내장된 프록시 생성기에게 현재 빈에 대한 프록시를 만들게 하고, 만들어진 프록시에 어드바이저를 연결해준다. 이렇게 프록시가 생성되면 컨테이너가 전달해준 빈 오브젝트 대신 생성된 프록시 오브젝트를 컨테이너에게 돌려주며, 최종적으로는 빈 후처리기가 돌려준 오브젝트를 빈으로 등록하고 사용한다. 이를 잘 활용하면 ProxyFactoryBean 설정 문제를 해결할 수 있다.</p>\n<h3 id=\"defaultadvisorautoproxycreator의-적용\" style=\"position:relative;\"><a href=\"#defaultadvisorautoproxycreator%EC%9D%98-%EC%A0%81%EC%9A%A9\" aria-label=\"defaultadvisorautoproxycreator의 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DefaultAdvisorAutoProxyCreator의 적용</h3>\n<p>자동 프록시 생성기에 대해 알아보았으니, 실제로 적용해보자. 적용하기 전에 포인트컷에 대해 추가로 알아야 할 내용이 있다. 앞서 포인트컷은 어드바이스를 적용할 메서드를 선정해주는 역할을 한다고 했는데, 사실 이 기능 외에도 프록시를 적용할 클래스인지 확인해주는 기능도 갖고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Pointcut</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">ClassFilter</span> <span class=\"token function\">getClassFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 프록시를 적용할 클래스인지 확인해준다.</span>\n\t<span class=\"token class-name\">MethodMatcher</span> <span class=\"token function\">getMethodMatcher</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 어드바이스를 적용할 메서드인지 확인해준다.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>우리가 사용했던 <code class=\"language-text\">NameMatchMethodPointcut</code> 은 메서드 선별 기능만 가진 특별한 포인트컷이다. 메서드 선별 기능만 가졌다는 것은 클래스 필터가 모든 클래스를 다 받아주도록 만들어져 있다는 뜻이다. 우리는 <code class=\"language-text\">NameMatchMethodPointcut</code> 을 상속하여 다음과 같은 클래스 필터 기능이 추가된 포인트컷을 만들 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NameMatchClassMethodPointcut</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">NameMatchMethodPointcut</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setMappedClassName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> mappedClassName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setClassFilter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleClassFilter</span><span class=\"token punctuation\">(</span>mappedClassName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SimpleClassFilter</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ClassFilter</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">String</span> mappedName<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">SimpleClassFilter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> mappedName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mappedName <span class=\"token operator\">=</span> mappedName<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">matches</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> clazz<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">PatternMatchUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">simpleMatch</span><span class=\"token punctuation\">(</span>mappedName<span class=\"token punctuation\">,</span> clazz<span class=\"token punctuation\">.</span><span class=\"token function\">getSimpleName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그리고 자동 프록시 생성기인 <code class=\"language-text\">DefaultAdvisorAutoProxyCreator</code> 를 빈으로 등록한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bean</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.springframework.aop.framwork.autoproxy.DefaultAdvisorAutoProxyCreator<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>이 빈 정의에는 id 속성이 없고 class 속성만 존재하는데, 다른 빈에서 참조되거나 코드에서 빈 이름으로 조회될 필요가 없는 빈이라면 아이디를 등록하지 않아도 된다.</p>\n<p>이제 앞에서 설정하였던 포인트컷 빈 설정을 다음과 같이 바꾼다.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bean</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>transactionPointcut<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>springbook.service.NameMatchClassMethodPointcut<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mappedClassName<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>*ServiceImpl<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mappedName<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>upgrade*<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bean</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>더 이상 명시적인 프록시 팩토리 빈을 등록하지 않아도 되기 때문에 ProxyFactoryBean 타입의 빈은 삭제한다. UserService와 관련된 빈 설정은 이제 다음 같은 설정으로 충분하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bean</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>userService<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>springbook.service.UserServiceImpl<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>userDao<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>userDao<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bean</span><span class=\"token punctuation\">></span></span></code></pre></div>","frontmatter":{"title":"프록시 3 - 프록시 팩토리 빈과 빈 후처리기","date":"September 27, 2021"}}},"pageContext":{"slug":"/spring/proxy-3-proxy-factory-bean/","previous":{"fields":{"slug":"/spring/proxy-2-dynamic-proxy/"},"frontmatter":{"title":"프록시 2 - 다이내믹 프록시와 팩토리 빈"}},"next":{"fields":{"slug":"/git/github-pages-auto-deployment/"},"frontmatter":{"title":"깃허브 페이지 배포 자동화"}}}},
    "staticQueryHashes": ["3078735561","3128451518"]}